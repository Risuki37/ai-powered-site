# 開発環境セットアップガイド

## 📋 概要

このガイドでは、ローカルPC上で開発環境をセットアップする手順を説明します。
本番環境はXREAサーバーですが、開発環境ではローカルMySQLを使用します。

---

## ✅ 前提条件

- Node.js v18以上がインストールされていること
- npm 9.0以上がインストールされていること

**確認コマンド**:
```bash
node --version  # v18以上を確認
npm --version   # v9.0以上を確認
```

---

## 🚀 セットアップ手順

### ステップ1: 依存関係のインストール

```bash
cd code
npm install
```

✅ **完了確認**: `node_modules`ディレクトリが作成されていること

---

### ステップ2: 環境変数ファイルの設定

`.env.local`ファイルが既に作成されているので、以下の内容を設定してください。

#### 2.1 NextAuth Secretの設定

既に生成されたNextAuth Secretを設定：
```
NEXTAUTH_SECRET="1jW6r5o7zCpXWlDjkHNt6K3Eud/TIz8v6pfaP13FQjk="
```

#### 2.2 データベース接続設定

**オプションA: ローカルMySQLを使用（推奨）**

ローカルMySQLをセットアップする場合：

1. **MySQLサーバーを起動**:
   ```bash
   # macOS (Homebrew)
   brew services start mysql
   
   # または手動で起動
   mysql.server start
   ```

2. **データベースとユーザーを作成**:
   ```bash
   mysql -u root -p
   ```
   
   MySQLに接続後：
   ```sql
   -- データベースを作成
   CREATE DATABASE IF NOT EXISTS ai_powered_site_dev 
     CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   
   -- ユーザーを作成（既存の場合はスキップ）
   CREATE USER IF NOT EXISTS 'dev_user'@'localhost' IDENTIFIED BY 'dev_password';
   
   -- 権限を付与
   GRANT ALL PRIVILEGES ON ai_powered_site_dev.* TO 'dev_user'@'localhost';
   FLUSH PRIVILEGES;
   
   -- 確認
   SHOW DATABASES;
   EXIT;
   ```

3. **`.env.local`に設定**:
   ```env
   DATABASE_URL="mysql://dev_user:dev_password@localhost:3306/ai_powered_site_dev?schema=public"
   ```

**オプションB: SQLiteを使用（簡易開発）**

開発中のみで、データベースセットアップを簡略化したい場合：

1. **Prismaスキーマを一時的にSQLiteに変更**:
   
   `prisma/schema.prisma`の`datasource`を変更：
   ```prisma
   datasource db {
     provider = "sqlite"
     url      = "file:./dev.db"
   }
   ```
   
   ⚠️ **注意**: 本番環境ではMySQLを使用するため、後で元に戻す必要があります。

2. **`.env.local`は不要**（SQLiteはファイルベース）

---

### ステップ3: Prismaクライアントの生成

```bash
npm run db:generate
```

✅ **完了確認**: `node_modules/.prisma/client`ディレクトリが作成されていること

---

### ステップ4: データベースマイグレーション

**ローカルMySQLを使用する場合**:
```bash
npm run db:migrate
```

**SQLiteを使用する場合**:
```bash
npx prisma db push
```

✅ **完了確認**: データベースにテーブルが作成されていること

---

### ステップ5: 開発サーバーの起動

```bash
npm run dev
```

ブラウザで `http://localhost:3000` にアクセス

✅ **完了確認**: 
- サーバーが正常に起動すること
- ブラウザでトップページが表示されること
- `/api/health`エンドポイントが正常に動作すること

---

## 🔧 トラブルシューティング

### MySQL接続エラー

**エラーメッセージ**: `Can't connect to local MySQL server`

**解決方法**:
1. MySQLサーバーが起動しているか確認
   ```bash
   brew services list | grep mysql
   # または
   ps aux | grep mysql
   ```
2. MySQLサーバーを起動
   ```bash
   brew services start mysql
   ```

### ポート3000が使用中

**エラーメッセージ**: `Port 3000 is already in use`

**解決方法**:
別のポートで起動：
```bash
PORT=3001 npm run dev
```

### Prismaクライアントの生成エラー

**解決方法**:
```bash
# Prismaスキーマを確認
cat prisma/schema.prisma

# クライアントを再生成
npm run db:generate
```

### データベース接続エラー

**解決方法**:
1. `.env.local`の`DATABASE_URL`を確認
2. データベースが作成されているか確認
   ```bash
   mysql -u root -p -e "SHOW DATABASES;"
   ```
3. ユーザー権限を確認
   ```bash
   mysql -u root -p -e "SHOW GRANTS FOR 'dev_user'@'localhost';"
   ```

---

## 📝 環境変数の完全な例

`.env.local`ファイルの完全な例：

```env
# ============================================
# データベース設定（ローカル開発環境）
# ============================================
DATABASE_URL="mysql://dev_user:dev_password@localhost:3306/ai_powered_site_dev?schema=public"

# ============================================
# NextAuth設定
# ============================================
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="1jW6r5o7zCpXWlDjkHNt6K3Eud/TIz8v6pfaP13FQjk="

# ============================================
# OAuth設定（オプション）
# ============================================
# Google OAuth（必要に応じて設定）
# GOOGLE_CLIENT_ID="your-google-client-id"
# GOOGLE_CLIENT_SECRET="your-google-client-secret"

# GitHub OAuth（必要に応じて設定）
# GITHUB_CLIENT_ID="your-github-client-id"
# GITHUB_CLIENT_SECRET="your-github-client-secret"

# ============================================
# AI API Keys（オプション）
# ============================================
# OPENAI_API_KEY="your-openai-api-key"
# GEMINI_API_KEY="your-gemini-api-key"
# ANTHROPIC_API_KEY="your-anthropic-api-key"

# ============================================
# 環境設定
# ============================================
NODE_ENV="development"
```

---

## 🎯 次のステップ

環境構築が完了したら：

1. **データベースマイグレーションの確認**
   ```bash
   npx prisma studio
   ```
   ブラウザでPrisma Studioが開き、データベースの状態を確認できます。

2. **初期データの投入（オプション）**
   ```bash
   npm run db:seed
   ```

3. **開発を開始**
   - ログインページ: `http://localhost:3000/login`
   - ダッシュボード: `http://localhost:3000/dashboard`
   - ブログ一覧: `http://localhost:3000/blog`

---

## 📚 参考ドキュメント

- [SETUP.md](./SETUP.md) - クイックスタートガイド
- [開発環境セットアップチェックリスト](./開発環境セットアップチェックリスト.md) - 詳細チェックリスト
- [ネクストアクション](../ネクストアクション.md) - 次の作業
- [開発環境構築手順書](../docs/開発環境構築手順書.md) - 詳細手順書

---

**最終更新**: 2025-11-29

